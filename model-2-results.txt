Model 2: FedProx



======================================================================
Edge-aware Federated Histopathology (Optimized for Preprocessed Data)
======================================================================
======================================================================
Checking for preprocessed data...
Preprocessing not found. Starting one-time image extraction and resizing...
Source Parquet Files: '/kaggle/input/fedalery-karye-ji/patchcamelyon_data'
Destination for PNGs: './preprocessed_patchcamelyon'

Processing split: 'train'...
  Converting train files: 100%|██████████| 13/13 [10:03<00:00, 46.46s/it]
Processing split: 'test'...
  Converting test files: 100%|██████████| 2/2 [01:15<00:00, 37.63s/it]
Processing split: 'validation'...
  Converting validation files: 100%|██████████| 2/2 [01:16<00:00, 38.27s/it]
Preprocessing complete. Images are saved and ready for fast loading.
======================================================================

Loading datasets from preprocessed image folders...

Creating non-IID splits for 5 clients...
  Attempting data split with random seed...
  Successfully created a valid split where all clients have data (using seed 16).

Initializing federated learning components...
  Client 0 - Samples: 131071, Class dist: [36309 94762], Weights: [1.8049382 1.3831599]
Downloading: "https://download.pytorch.org/models/mobilenet_v2-b0353104.pth" to /root/.cache/torch/hub/checkpoints/mobilenet_v2-b0353104.pth
100%|██████████| 13.6M/13.6M [00:00<00:00, 157MB/s]
  Client 1 - Samples: 95945, Class dist: [94763  1182], Weights: [ 0.5062366 81.171745 ]
  Client 2 - Samples: 11828, Class dist: [    0 11828], Weights: [1. 2.]
  Client 3 - Samples: 9963, Class dist: [   0 9963], Weights: [1. 2.]
  Client 4 - Samples: 13337, Class dist: [    0 13337], Weights: [1. 2.]

======================================================================
Starting Federated Learning
======================================================================


======================================== Round 1/20 ========================================

--- Client 0 training...

--- Client 1 training...

--- Client 2 training...

--- Client 3 training...

--- Client 4 training...

--- Server aggregating client updates...

--- Evaluating global model...

Round 1 Results (Thresh=0.50): Acc: 0.6626, Prec: 0.6241, Rec: 0.8168, F1: 0.7076, AUC: 0.7542

======================================== Round 2/20 ========================================

--- Client 0 training...

--- Client 1 training...

--- Client 2 training...

--- Client 3 training...

--- Client 4 training...

--- Server aggregating client updates...

--- Evaluating global model...

Round 2 Results (Thresh=0.50): Acc: 0.7163, Prec: 0.6669, Rec: 0.8637, F1: 0.7527, AUC: 0.8138

======================================== Round 3/20 ========================================

--- Client 0 training...

--- Client 1 training...

--- Client 2 training...

--- Client 3 training...

--- Client 4 training...

--- Server aggregating client updates...

--- Evaluating global model...

Round 3 Results (Thresh=0.50): Acc: 0.7503, Prec: 0.7072, Rec: 0.8538, F1: 0.7736, AUC: 0.8384

======================================== Round 4/20 ========================================

--- Client 0 training...

--- Client 1 training...

--- Client 2 training...

--- Client 3 training...

--- Client 4 training...

--- Server aggregating client updates...

--- Evaluating global model...

Round 4 Results (Thresh=0.50): Acc: 0.7227, Prec: 0.6542, Rec: 0.9446, F1: 0.7730, AUC: 0.8476

======================================== Round 5/20 ========================================

Round 5: Starting Fine-Tuning Phase

--- Client 0 training...

--- Client 1 training...

--- Client 2 training...

--- Client 3 training...

--- Client 4 training...

--- Server aggregating client updates...

--- Evaluating global model...

Round 5 Results (Thresh=0.50): Acc: 0.6890, Prec: 0.6321, Rec: 0.9037, F1: 0.7439, AUC: 0.7514

======================================== Round 6/20 ========================================

--- Client 0 training...

--- Client 1 training...

--- Client 2 training...

--- Client 3 training...

--- Client 4 training...

--- Server aggregating client updates...

--- Evaluating global model...

Round 6 Results (Thresh=0.50): Acc: 0.7473, Prec: 0.7182, Rec: 0.8138, F1: 0.7630, AUC: 0.7818

======================================== Round 7/20 ========================================

--- Client 0 training...

--- Client 1 training...

--- Client 2 training...

--- Client 3 training...

--- Client 4 training...

--- Server aggregating client updates...

--- Evaluating global model...

Round 7 Results (Thresh=0.50): Acc: 0.7627, Prec: 0.7635, Rec: 0.7609, F1: 0.7622, AUC: 0.8428

======================================== Round 8/20 ========================================

--- Client 0 training...

--- Client 1 training...

--- Client 2 training...

--- Client 3 training...

--- Client 4 training...

--- Server aggregating client updates...

--- Evaluating global model...

Round 8 Results (Thresh=0.50): Acc: 0.8004, Prec: 0.8240, Rec: 0.7637, F1: 0.7927, AUC: 0.8873

======================================== Round 9/20 ========================================

--- Client 0 training...

--- Client 1 training...

--- Client 2 training...

--- Client 3 training...

--- Client 4 training...

--- Server aggregating client updates...

--- Evaluating global model...

Round 9 Results (Thresh=0.50): Acc: 0.7907, Prec: 0.8009, Rec: 0.7736, F1: 0.7870, AUC: 0.8775

======================================== Round 10/20 ========================================

--- Client 0 training...

--- Client 1 training...

--- Client 2 training...

--- Client 3 training...

--- Client 4 training...

--- Server aggregating client updates...

--- Evaluating global model...

Round 10 Results (Thresh=0.50): Acc: 0.7478, Prec: 0.7290, Rec: 0.7885, F1: 0.7576, AUC: 0.7989

======================================== Round 11/20 ========================================

--- Client 0 training...

--- Client 1 training...

--- Client 2 training...

--- Client 3 training...

--- Client 4 training...

--- Server aggregating client updates...

--- Evaluating global model...

Round 11 Results (Thresh=0.50): Acc: 0.7787, Prec: 0.8316, Rec: 0.6987, F1: 0.7594, AUC: 0.8651

======================================== Round 12/20 ========================================

--- Client 0 training...

--- Client 1 training...

--- Client 2 training...

--- Client 3 training...

--- Client 4 training...

--- Server aggregating client updates...

--- Evaluating global model...

Round 12 Results (Thresh=0.50): Acc: 0.7215, Prec: 0.7598, Rec: 0.6474, F1: 0.6991, AUC: 0.7876

======================================== Round 13/20 ========================================

--- Client 0 training...

--- Client 1 training...

--- Client 2 training...

--- Client 3 training...

--- Client 4 training...

--- Server aggregating client updates...

--- Evaluating global model...

Round 13 Results (Thresh=0.50): Acc: 0.7317, Prec: 0.7626, Rec: 0.6723, F1: 0.7147, AUC: 0.7897

======================================== Round 14/20 ========================================

--- Client 0 training...

--- Client 1 training...

--- Client 2 training...

--- Client 3 training...

--- Client 4 training...

--- Server aggregating client updates...

--- Evaluating global model...

Round 14 Results (Thresh=0.50): Acc: 0.7435, Prec: 0.8259, Rec: 0.6168, F1: 0.7062, AUC: 0.8483

======================================== Round 15/20 ========================================

--- Client 0 training...

--- Client 1 training...

--- Client 2 training...

--- Client 3 training...

--- Client 4 training...

--- Server aggregating client updates...

--- Evaluating global model...

Round 15 Results (Thresh=0.50): Acc: 0.7377, Prec: 0.8066, Rec: 0.6250, F1: 0.7043, AUC: 0.8259

======================================== Round 16/20 ========================================

--- Client 0 training...

--- Client 1 training...

--- Client 2 training...

--- Client 3 training...

--- Client 4 training...

--- Server aggregating client updates...

--- Evaluating global model...

Round 16 Results (Thresh=0.50): Acc: 0.7504, Prec: 0.8814, Rec: 0.5784, F1: 0.6984, AUC: 0.8777

======================================== Round 17/20 ========================================

--- Client 0 training...

--- Client 1 training...

--- Client 2 training...

--- Client 3 training...

--- Client 4 training...

--- Server aggregating client updates...

--- Evaluating global model...

Round 17 Results (Thresh=0.50): Acc: 0.7248, Prec: 0.8283, Rec: 0.5669, F1: 0.6731, AUC: 0.8426

======================================== Round 18/20 ========================================

--- Client 0 training...

--- Client 1 training...

--- Client 2 training...

--- Client 3 training...

--- Client 4 training...

--- Server aggregating client updates...

--- Evaluating global model...

Round 18 Results (Thresh=0.50): Acc: 0.7523, Prec: 0.8259, Rec: 0.6391, F1: 0.7206, AUC: 0.8509

======================================== Round 19/20 ========================================

--- Client 0 training...

--- Client 1 training...

--- Client 2 training...

--- Client 3 training...

--- Client 4 training...

--- Server aggregating client updates...

--- Evaluating global model...

Round 19 Results (Thresh=0.50): Acc: 0.7579, Prec: 0.9006, Rec: 0.5795, F1: 0.7052, AUC: 0.8944

======================================== Round 20/20 ========================================

--- Client 0 training...

--- Client 1 training...

--- Client 2 training...

--- Client 3 training...

--- Client 4 training...

--- Server aggregating client updates...

--- Evaluating global model...

Round 20 Results (Thresh=0.50): Acc: 0.7348, Prec: 0.8685, Rec: 0.5530, F1: 0.6758, AUC: 0.8684

======================================================================
FINAL RESULTS SUMMARY
======================================================================

Classification Performance at Standard Threshold (0.50):
  Final Accuracy:  0.7348
  Final Precision: 0.8685
  Final Recall:    0.5530
  Final F1-Score:  0.6758
  Final AUC:       0.8684

Classification Performance at FedAlert Threshold (0.75):
  Final Accuracy:  0.6157
  Final Precision: 0.8744
  Final Recall:    0.2698
  Final F1-Score:  0.4124
  Final AUC:       0.8684

Generating visualizations...

