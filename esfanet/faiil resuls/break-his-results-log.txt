*proposed solution*
Agentic ESFA breakhis dataset results
Using device: cuda
PyTorch Version: 2.6.0+cu124
Step 1: Loading and splitting BreakHis data...
Found 7909 images
Class distribution: {1: 5429, 0: 2480}
Dataset split:
  - Training:   5377 images
  - Validation: 950 images
  - Testing:    1582 images

Step 2: Initializing the revised EFSANet model...
Downloading: "https://download.pytorch.org/models/densenet121-a639ec97.pth" to /root/.cache/torch/hub/checkpoints/densenet121-a639ec97.pth
100%|██████████| 30.8M/30.8M [00:00<00:00, 129MB/s]
Class distribution in training set: Benign: 1686, Malignant: 3691
Using Evidential Deep Learning (EDL) Loss

Step 3: Starting model training...

--- Epoch 1/30 ---
                                                         
Epoch 1 Summary | Time: 51.54s | LR: 0.000100
  Train Loss: 0.4239, Train F1: 0.7077
  Val Loss:   0.2808, Val F1:   0.8255
  Val Accuracy: 0.8516, Precision: 0.8298, Recall: 0.8217
Validation F1 improved from 0.0000 to 0.8255. Saving model...

--- Epoch 2/30 ---
                                                         
Epoch 2 Summary | Time: 37.80s | LR: 0.000099
  Train Loss: 0.2381, Train F1: 0.8488
  Val Loss:   0.1841, Val F1:   0.8897
  Val Accuracy: 0.9084, Precision: 0.9071, Recall: 0.8768
Validation F1 improved from 0.8255 to 0.8897. Saving model...

--- Epoch 3/30 ---
                                                         
Epoch 3 Summary | Time: 37.42s | LR: 0.000098
  Train Loss: 0.1890, Train F1: 0.8927
  Val Loss:   0.1660, Val F1:   0.9081
  Val Accuracy: 0.9179, Precision: 0.8968, Recall: 0.9247
Validation F1 improved from 0.8897 to 0.9081. Saving model...

--- Epoch 4/30 ---
                                                         
Epoch 4 Summary | Time: 37.43s | LR: 0.000096
  Train Loss: 0.1729, Train F1: 0.9100
  Val Loss:   0.1727, Val F1:   0.9046
  Val Accuracy: 0.9211, Precision: 0.9251, Recall: 0.8896

--- Epoch 5/30 ---
                                                         
Epoch 5 Summary | Time: 37.50s | LR: 0.000093
  Train Loss: 0.1671, Train F1: 0.9133
  Val Loss:   0.1388, Val F1:   0.9304
  Val Accuracy: 0.9411, Precision: 0.9385, Recall: 0.9233
Validation F1 improved from 0.9081 to 0.9304. Saving model...

--- Epoch 6/30 ---
                                                         
Epoch 6 Summary | Time: 36.92s | LR: 0.000091
  Train Loss: 0.1613, Train F1: 0.9207
  Val Loss:   0.1324, Val F1:   0.9390
  Val Accuracy: 0.9484, Precision: 0.9478, Recall: 0.9314
Validation F1 improved from 0.9304 to 0.9390. Saving model...

--- Epoch 7/30 ---
                                                         
Epoch 7 Summary | Time: 37.34s | LR: 0.000087
  Train Loss: 0.1536, Train F1: 0.9257
  Val Loss:   0.1418, Val F1:   0.9373
  Val Accuracy: 0.9463, Precision: 0.9402, Recall: 0.9345

--- Epoch 8/30 ---
                                                         
Epoch 8 Summary | Time: 37.08s | LR: 0.000084
  Train Loss: 0.1282, Train F1: 0.9424
  Val Loss:   0.1297, Val F1:   0.9397
  Val Accuracy: 0.9474, Precision: 0.9341, Recall: 0.9462
Validation F1 improved from 0.9390 to 0.9397. Saving model...

--- Epoch 9/30 ---
                                                         
Epoch 9 Summary | Time: 37.30s | LR: 0.000080
  Train Loss: 0.1283, Train F1: 0.9416
  Val Loss:   0.1103, Val F1:   0.9551
  Val Accuracy: 0.9611, Precision: 0.9523, Recall: 0.9580
Validation F1 improved from 0.9397 to 0.9551. Saving model...

--- Epoch 10/30 ---
                                                         
Epoch 10 Summary | Time: 37.09s | LR: 0.000075
  Train Loss: 0.1142, Train F1: 0.9487
  Val Loss:   0.1231, Val F1:   0.9513
  Val Accuracy: 0.9579, Precision: 0.9497, Recall: 0.9529

--- Epoch 11/30 ---
                                                         
Epoch 11 Summary | Time: 37.28s | LR: 0.000071
  Train Loss: 0.1057, Train F1: 0.9560
  Val Loss:   0.1274, Val F1:   0.9441
  Val Accuracy: 0.9505, Precision: 0.9339, Recall: 0.9576

--- Epoch 12/30 ---
                                                         
Epoch 12 Summary | Time: 37.17s | LR: 0.000066
  Train Loss: 0.0935, Train F1: 0.9611
  Val Loss:   0.1209, Val F1:   0.9479
  Val Accuracy: 0.9558, Precision: 0.9552, Recall: 0.9414

--- Epoch 13/30 ---
                                                         
Epoch 13 Summary | Time: 37.07s | LR: 0.000061
  Train Loss: 0.0892, Train F1: 0.9633
  Val Loss:   0.0966, Val F1:   0.9610
  Val Accuracy: 0.9663, Precision: 0.9594, Recall: 0.9627
Validation F1 improved from 0.9551 to 0.9610. Saving model...

--- Epoch 14/30 ---
                                                         
Epoch 14 Summary | Time: 37.27s | LR: 0.000056
  Train Loss: 0.0786, Train F1: 0.9687
  Val Loss:   0.1354, Val F1:   0.9395
  Val Accuracy: 0.9495, Precision: 0.9557, Recall: 0.9268

--- Epoch 15/30 ---
                                                         
Epoch 15 Summary | Time: 37.02s | LR: 0.000051
  Train Loss: 0.0719, Train F1: 0.9728
  Val Loss:   0.0968, Val F1:   0.9585
  Val Accuracy: 0.9642, Precision: 0.9577, Recall: 0.9594

--- Epoch 16/30 ---
                                                         
Epoch 16 Summary | Time: 36.96s | LR: 0.000045
  Train Loss: 0.0628, Train F1: 0.9758
  Val Loss:   0.1299, Val F1:   0.9464
  Val Accuracy: 0.9547, Precision: 0.9564, Recall: 0.9379

--- Epoch 17/30 ---
                                                         
Epoch 17 Summary | Time: 36.44s | LR: 0.000040
  Train Loss: 0.0589, Train F1: 0.9757
  Val Loss:   0.1055, Val F1:   0.9566
  Val Accuracy: 0.9632, Precision: 0.9636, Recall: 0.9504

--- Epoch 18/30 ---
                                                         
Epoch 18 Summary | Time: 36.74s | LR: 0.000035
  Train Loss: 0.0549, Train F1: 0.9782
  Val Loss:   0.0876, Val F1:   0.9622
  Val Accuracy: 0.9674, Precision: 0.9610, Recall: 0.9635
Validation F1 improved from 0.9610 to 0.9622. Saving model...

--- Epoch 19/30 ---
                                                         
Epoch 19 Summary | Time: 36.79s | LR: 0.000030
  Train Loss: 0.0579, Train F1: 0.9782
  Val Loss:   0.0791, Val F1:   0.9694
  Val Accuracy: 0.9737, Precision: 0.9707, Recall: 0.9681
Validation F1 improved from 0.9622 to 0.9694. Saving model...

--- Epoch 20/30 ---
                                                         
Epoch 20 Summary | Time: 37.31s | LR: 0.000026
  Train Loss: 0.0512, Train F1: 0.9812
  Val Loss:   0.1432, Val F1:   0.9408
  Val Accuracy: 0.9505, Precision: 0.9565, Recall: 0.9284

--- Epoch 21/30 ---
                                                         
Epoch 21 Summary | Time: 36.70s | LR: 0.000021
  Train Loss: 0.0460, Train F1: 0.9831
  Val Loss:   0.1190, Val F1:   0.9475
  Val Accuracy: 0.9558, Precision: 0.9592, Recall: 0.9377

--- Epoch 22/30 ---
                                                         
Epoch 22 Summary | Time: 36.93s | LR: 0.000017
  Train Loss: 0.0470, Train F1: 0.9827
  Val Loss:   0.1199, Val F1:   0.9475
  Val Accuracy: 0.9558, Precision: 0.9592, Recall: 0.9377

--- Epoch 23/30 ---
                                                         
Epoch 23 Summary | Time: 37.10s | LR: 0.000014
  Train Loss: 0.0397, Train F1: 0.9862
  Val Loss:   0.1043, Val F1:   0.9576
  Val Accuracy: 0.9642, Precision: 0.9673, Recall: 0.9493

--- Epoch 24/30 ---
                                                         
Epoch 24 Summary | Time: 36.84s | LR: 0.000010
  Train Loss: 0.0353, Train F1: 0.9881
  Val Loss:   0.0905, Val F1:   0.9632
  Val Accuracy: 0.9684, Precision: 0.9649, Recall: 0.9615

--- Epoch 25/30 ---
                                                         
Epoch 25 Summary | Time: 37.02s | LR: 0.000008
  Train Loss: 0.0414, Train F1: 0.9853
  Val Loss:   0.0802, Val F1:   0.9667
  Val Accuracy: 0.9716, Precision: 0.9708, Recall: 0.9629

--- Epoch 26/30 ---
                                                         
Epoch 26 Summary | Time: 36.77s | LR: 0.000005
  Train Loss: 0.0341, Train F1: 0.9881
  Val Loss:   0.0869, Val F1:   0.9609
  Val Accuracy: 0.9663, Precision: 0.9609, Recall: 0.9609

--- Epoch 27/30 ---
                                                         
Epoch 27 Summary | Time: 36.58s | LR: 0.000003
  Train Loss: 0.0378, Train F1: 0.9862
  Val Loss:   0.0766, Val F1:   0.9697
  Val Accuracy: 0.9737, Precision: 0.9661, Recall: 0.9735
Validation F1 improved from 0.9694 to 0.9697. Saving model...

--- Epoch 28/30 ---
                                                         
Epoch 28 Summary | Time: 36.62s | LR: 0.000002
  Train Loss: 0.0390, Train F1: 0.9859
  Val Loss:   0.1237, Val F1:   0.9523
  Val Accuracy: 0.9600, Precision: 0.9665, Recall: 0.9408

--- Epoch 29/30 ---
                                                         
Epoch 29 Summary | Time: 36.68s | LR: 0.000001
  Train Loss: 0.0370, Train F1: 0.9864
  Val Loss:   0.0955, Val F1:   0.9590
  Val Accuracy: 0.9653, Precision: 0.9671, Recall: 0.9519

--- Epoch 30/30 ---
                                                         
Epoch 30 Summary | Time: 36.57s | LR: 0.000001
  Train Loss: 0.0358, Train F1: 0.9879
  Val Loss:   0.1050, Val F1:   0.9555
  Val Accuracy: 0.9621, Precision: 0.9609, Recall: 0.9505

Training finished.

Step 4: Performing final evaluation on the test set...
                                                           
Average Uncertainty on Correct Predictions: 0.1128
Average Uncertainty on Wrong Predictions:   0.3273
Uncertainty plot saved.
Risk Retention Curve Saved.

--- Test Set Results ---
  - Accuracy:  0.9684
  - Precision: 0.9602 (Macro)
  - Recall:    0.9671 (Macro)
  - F1 Score:  0.9636 (Macro)
--- Classification Report ---
              precision    recall  f1-score   support

      Benign       0.94      0.96      0.95       496
   Malignant       0.98      0.97      0.98      1086

    accuracy                           0.97      1582
   macro avg       0.96      0.97      0.96      1582
weighted avg       0.97      0.97      0.97      1582
